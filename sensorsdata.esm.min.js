const sa={lib_version:'0.1.2',lib_method:'code',lib_name:'WeCode',is_first_launch:!1,_queue:[],hasInit:!1,initUserComplete:!1,getSystemComplete:!1,mpshow_time:void 0,systemList:{deviceInfo:!1,weCodeInfo:!1,netWorkType:!1},para:{server_url:'',show_log:!0,appid:'',request_type:'fetch'},debug_appid:''},setStorage=function(t){var e=JSON.stringify(t),r=sa.para.appid+'_sensorsdata2015_welink';localStorage.setItem(r,e)},getStorage=function(){var t=sa.para.appid+'_sensorsdata2015_welink';return JSON.parse(localStorage.getItem(t))},_={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIndexOf=ArrayProto.indexOf,nativeIsArray=Array.isArray,breaker={},each=_.each=function(t,e,r){if(null===t)return!1;if(nativeForEach&&t.forEach===nativeForEach)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,i=t.length;n<i;n++)if(n in t&&e.call(r,t[n],n,t)===breaker)return!1}else for(var a in t)if(hasOwnProperty.call(t,a)&&e.call(r,t[a],a,t)===breaker)return!1};_.extend=function(t){return each(slice.call(arguments,1),function(e){for(var r in e)void 0!==e[r]&&(t[r]=e[r])}),t},_.extend2Lev=function(t){return each(slice.call(arguments,1),function(e){for(var r in e)void 0!==e[r]&&(_.isObject(e[r])&&_.isObject(t[r])?_.extend(t[r],e[r]):t[r]=e[r])}),t},_.coverExtend=function(t){return each(slice.call(arguments,1),function(e){for(var r in e)void 0!==e[r]&&void 0===t[r]&&(t[r]=e[r])}),t},_.isArray=nativeIsArray||function(t){return'[object Array]'===toString.call(t)},_.isFunction=function(t){try{return/^\s*\bfunction\b/.test(t)}catch(t){return!1}},_.isArguments=function(t){return!(!t||!hasOwnProperty.call(t,'callee'))},_.toArray=function(t){return t?t.toArray?t.toArray():_.isArray(t)?slice.call(t):_.isArguments(t)?slice.call(t):_.values(t):[]},_.values=function(t){var e=[];return null===t?e:(each(t,function(t){e[e.length]=t}),e)},_.include=function(t,e){var r=!1;return null===t?r:nativeIndexOf&&t.indexOf===nativeIndexOf?-1!==t.indexOf(e):(each(t,function(t){if(r||(r=t===e))return breaker}),r)},_.trim=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')},_.isObject=function(t){return'[object Object]'===toString.call(t)&&null!==t},_.isEmptyObject=function(t){if(_.isObject(t)){for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0}return!1},_.isUndefined=function(t){return void 0===t},_.isString=function(t){return'[object String]'===toString.call(t)},_.isDate=function(t){return'[object Date]'===toString.call(t)},_.isBoolean=function(t){return'[object Boolean]'===toString.call(t)},_.isNumber=function(t){return'[object Number]'===toString.call(t)&&/[\d\.]+/.test(String(t))},_.isJSONString=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},_.decodeURIComponent=function(t){var e='';try{e=decodeURIComponent(t)}catch(r){e=t}return e},_.encodeDates=function(t){return _.each(t,function(e,r){_.isDate(e)?t[r]=_.formatDate(e):_.isObject(e)&&(t[r]=_.encodeDates(e))}),t},_.formatDate=function(t){function e(t){return t<10?'0'+t:t}return t.getFullYear()+'-'+e(t.getMonth()+1)+'-'+e(t.getDate())+' '+e(t.getHours())+':'+e(t.getMinutes())+':'+e(t.getSeconds())+'.'+e(t.getMilliseconds())},_.searchObjDate=function(t){_.isObject(t)&&_.each(t,function(e,r){_.isObject(e)?_.searchObjDate(t[r]):_.isDate(e)&&(t[r]=_.formatDate(e))})},_.searchObjString=function(t){_.isObject(t)&&_.each(t,function(e,r){_.isObject(e)?_.searchObjString(t[r]):_.isString(e)&&(t[r]=_.formatString(e))})},_.formatString=function(t){return t.length>sa.para.max_string_length?(sa.log('\u5b57\u7b26\u4e32\u957f\u5ea6\u8d85\u8fc7\u9650\u5236\uff0c\u5df2\u7ecf\u505a\u622a\u53d6--'+t),t.slice(0,sa.para.max_string_length)):t},_.unique=function(t){for(var e,r=[],n={},i=0;i<t.length;i++)(e=t[i])in n||(n[e]=!0,r.push(e));return r},_.strip_sa_properties=function(t){return _.isObject(t)?(_.each(t,function(e,r){if(_.isArray(e)){var n=[];_.each(e,function(t){_.isString(t)?n.push(t):sa.log('\u60a8\u7684\u6570\u636e-',e,'\u7684\u6570\u7ec4\u91cc\u7684\u503c\u5fc5\u987b\u662f\u5b57\u7b26\u4e32,\u5df2\u7ecf\u5c06\u5176\u5220\u9664')}),0!==n.length?t[r]=n:(delete t[r],sa.log('\u5df2\u7ecf\u5220\u9664\u7a7a\u7684\u6570\u7ec4'))}_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||(sa.log('\u60a8\u7684\u6570\u636e-',e,'-\u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664'),delete t[r])}),t):t},_.strip_empty_properties=function(t){var e={};return _.each(t,function(t,r){null!==t&&(e[r]=t)}),e},_.utf8Encode=function(t){var e,r,n,i,a='';for(e=r=0,n=(t=(t+'').replace(/\r\n/g,'\n').replace(/\r/g,'\n')).length,i=0;i<n;i++){var s=t.charCodeAt(i),o=null;s<128?r++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(r>e&&(a+=t.substring(e,r)),a+=o,e=r=i+1)}return r>e&&(a+=t.substring(e,t.length)),a},_.base64Encode=function(t){var e,r,n,i,a,s='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',o=0,c=0,p='',u=[];if(!t)return t;t=_.utf8Encode(t);do{e=(a=t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++))>>18&63,r=a>>12&63,n=a>>6&63,i=63&a,u[c++]=s.charAt(e)+s.charAt(r)+s.charAt(n)+s.charAt(i)}while(o<t.length);switch(p=u.join(''),t.length%3){case 1:p=p.slice(0,-2)+'==';break;case 2:p=p.slice(0,-1)+'='}return p},_.checkInitComplete=function(){sa.initUserComplete&&sa.getSystemComplete&&(sa.hasInit=!0,sa._queue.length>0&&(_.each(sa._queue,function(t){if('prepareData'===t.event){var e=Array.prototype.slice.apply(t.arg)[0];e.properties=_.stripUrl(e.properties),sa.prepareData.call(sa,e)}else sa[t.event].apply(sa,t.arg)}),this._queue=[]))},_.getUUID=function(){return Date.now()+'-'+Math.floor(1e7*Math.random())+'-'+Math.random().toString(16).replace('.','')+'-'+String(31242*Math.random()).replace('.','').slice(0,8)},_.request=function(t){HWH5[sa.para.request_type](t,{method:'get',headers:{'Content-Type':'application/json'},timeout:3e4}).then(function(t){sa.log('\u53d1\u9001\u8bf7\u6c42\u6210\u529f: ',t)}).catch(function(t){sa.log('\u8bf7\u6c42\u5f02\u5e38',t)})},_.getPath=function(){var t=window.document.location.hash.split('#')[1];return t||t},_.getUrl=function(){var t=sa.debug_appid,e=location.href||'';return t?_.matchUrl(e,t):e},_.matchUrl=function(t,e){return t.split(e)[1]||t},_.stripUrl=function(t){var e=sa.debug_appid;return e&&t.$url&&(t.$url=_.matchUrl(t.$url,e)),t},_.formatSystem=function(t){var e=t.toLowerCase();return'ios'===e?'iOS':'android'===e?'Android':t},_.formatManufacturer=function(t){return t.split('-')[0]},_.getAppId=function(){var t=location.href.match(/\d{8,}/g),e='';return t&&t.length>0&&(e=_.resolveId(t)),e},_.resolveId=function(t){for(var e=t.length||0,r=0;r<e;r++){var n=t[r].slice(0,4),i=t[r].slice(4,6),a=t[r].slice(6,8);if(n&&i&&a){var s=new Date(n,i,a);if(_.isDate(s))return t[r]}}return''},_.stripAppId=function(t){var e=t.indexOf('.debug');return e>-1?t.slice(0,e):t},sa._=_;var store={_state:{},toState:function(t){'object'==typeof t&&t.distinct_id?this._state=t:this.set('distinct_id',_.getUUID())},getFirstId:function(){return this._state.first_id},getDistinctId:function(){return this._state.distinct_id},getProps:function(){return this._state.props||{}},setProps:function(t,e){var r=this._state.props||{};e?this.set('props',t):(_.extend(r,t),this.set('props',r))},set:function(t,e){var r={};for(var n in'string'==typeof t?r[t]=e:'object'==typeof t&&(r=t),this._state=this._state||{},r)this._state[n]=r[n];this.save()},save:function(){var t,e,r;t=this._state,e=JSON.stringify(t),r=sa.para.appid+'_sensorsdata2015_welink',localStorage.setItem(r,e)}};sa.store=store;var info={currentProps:{},properties:{$lib:sa.lib_name,$lib_version:String(sa.lib_version)}};function initUser(){var t=getStorage();if(t)store.toState(t);else{sa.is_first_launch=!0;var e=new Date,r=e.getTime();e.setHours(23),e.setMinutes(59),e.setSeconds(60),sa.setOnceProfile({$first_visit_time:new Date}),store.set({distinct_id:_.getUUID(),first_visit_time:r,first_visit_day_time:e.getTime()})}sa.initUserComplete=!0,_.checkInitComplete()}function getSystemInfo(){var t=sa.info.properties,e=(new Date).getTimezoneOffset();_.isNumber(e)&&(t.$timezone_offset=e),HWH5.getDeviceInfo().then(function(e){t.$os=_.formatSystem(e.osType),'iOS'===t.$os?t.$manufacturer=_.formatManufacturer(e.deviceName):t.$manufacturer=e.deviceName,t.$os_version=e.osVersion,sa.systemList.deviceInfo=!0,checkGetSystemComplete()}).catch(function(t){sa.log('\u83b7\u53d6\u8bbe\u5907\u4fe1\u606f\u5f02\u5e38',t)}),HWH5.getWecodeInfo().then(function(e){var r=_.stripAppId(e.appId);sa.debug_appid=e.appId,r&&(sa.para.appid=r),t.$app_id=sa.para.appid,sa.systemList.weCodeInfo=!0,checkGetSystemComplete()}).catch(function(t){sa.log('\u83b7\u53d6\u5c0f\u7a0b\u5e8f\u4fe1\u606f\u5f02\u5e38',t)}),HWH5.getNetworkType().then(function(e){t.$network_type=e.type,sa.systemList.netWorkType=!0,checkGetSystemComplete()}).catch(function(t){sa.log('\u8fd4\u56de\u7f51\u7edc\u72b6\u6001\u5f02\u5e38',t)})}function checkGetSystemComplete(){sa.systemList.deviceInfo&&sa.systemList.weCodeInfo&&sa.systemList.netWorkType&&(sa.getSystemComplete=!0,_.checkInitComplete())}function init(t){if(_.isObject(t)){if(sa.para=_.extend2Lev(sa.para,t),!sa.para.server_url)return sa.log('\u8bf7\u8c03\u7528 init \u65f6\u8bbe\u7f6e server_url \u6570\u636e\u63a5\u6536\u5730\u5740\uff01'),!1;sa.para.appid||(sa.para.appid=_.getAppId()),'fetchInternet'!==sa.para.request_type&&'fetchVPN'!==sa.para.request_type&&'fetch'!==sa.para.request_type&&(sa.para.request_type='fetch')}initUser(),getSystemInfo()}sa.info=info,sa.init=init,sa.log=function(){if(sa.para.show_log&&'object'==typeof console&&console.log)try{var t=Array.prototype.slice.call(arguments);return t.unshift('sensorsdata: '),console.log.apply(console,t)}catch(t){console.log('sensorsdata: ',arguments[0])}},sa.prepareData=function(t){var e={distinct_id:store.getDistinctId(),lib:{$lib:sa.lib_name,$lib_method:sa.lib_method,$lib_version:String(sa.lib_version)},properties:{}};_.extend(e,t),_.isObject(t.properties)&&!_.isEmptyObject(t.properties)&&_.extend(e.properties,t.properties),t.type&&'profile'===t.type.slice(0,7)||(e._track_id=Number(String(Math.random()).slice(2,5)+String(Math.random()).slice(2,4)+String(Date.now()).slice(-4)),e.properties=_.extend({},sa.info.properties,sa.store.getProps(),sa.info.currentProps,e.properties),'object'==typeof store._state&&'number'==typeof store._state.first_visit_day_time&&store._state.first_visit_day_time>(new Date).getTime()?e.properties.$is_first_day=!0:e.properties.$is_first_day=!1),e.properties.$time&&_.isDate(e.properties.$time)?(e.time=1*e.properties.$time,delete e.properties.$time):e.time=1*new Date,_.searchObjDate(e),_.searchObjString(e),sa.send(e)},sa.setProfile=function(t){sa.prepareData({type:'profile_set',properties:t})},sa.setOnceProfile=function(t){sa.prepareData({type:'profile_set_once',properties:t})},sa.track=function(t,e){var r=_.extend({$url_path:_.getPath(),$url:_.getUrl()},e);this.prepareData({type:'track',event:t,properties:r})},sa.identify=function(t){if('number'==typeof t)t=String(t);else if('string'!=typeof t)return!1;store.getFirstId()?store.set('first_id',t):store.set('distinct_id',t)},sa.trackSignup=function(t,e,r){sa.prepareData({original_id:sa.store.getFirstId()||sa.store.getDistinctId(),distinct_id:t,type:'track_signup',event:e,properties:r}),sa.store.set('distinct_id',t)},sa.registerApp=function(t){_.isObject(t)&&!_.isEmptyObject(t)&&(sa.info.currentProps=_.extend(sa.info.currentProps,t))},sa.clearAppRegister=function(t){_.isArray(t)&&_.each(sa.info.currentProps,function(e,r){_.include(t,r)&&delete sa.info.currentProps[r]})},sa.appLaunch=function(t){t&&_.isObject(t)||(t={});var e={};sa.is_first_launch?e.$is_first_time=!0:e.$is_first_time=!1,_.extend(e,t),sa.track('$MPLaunch',e)},sa.appShow=function(t){t&&_.isObject(t)||(t={});var e={};sa.mpshow_time=(new Date).getTime(),_.extend(e,t),sa.track('$MPShow',e)},sa.appHide=function(t){t&&_.isObject(t)||(t={});var e=(new Date).getTime(),r={};sa.mpshow_time&&e-sa.mpshow_time>0&&(e-sa.mpshow_time)/36e5<24&&(r.event_duration=(e-sa.mpshow_time)/1e3),_.extend(r,t),sa.track('$MPHide',r)},sa.pageShow=function(t){var e={};e.$url_path=_.getPath(),_.extend(e,t),sa.track('$MPViewScreen',e)},sa.login=function(t){var e=store.getFirstId(),r=store.getDistinctId();t!==r&&(e?sa.trackSignup(t,'$SignUp'):(store.set('first_id',r),sa.trackSignup(t,'$SignUp')))},sa.logout=function(t){var e=store.getFirstId();e?(store.set('first_id',''),!0===t?store.set('distinct_id',_.getUUID()):store.set('distinct_id',e)):sa.log('\u6ca1\u6709first_id\uff0clogout\u5931\u8d25')},sa.send=function(t){var e='';t._nocache=(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15),sa.log(t),t._flush_time=Date.now(),t=JSON.stringify(t),e=-1!==sa.para.server_url.indexOf('?')?sa.para.server_url+'&data='+encodeURIComponent(_.base64Encode(t)):sa.para.server_url+'?data='+encodeURIComponent(_.base64Encode(t)),_.request(e)},_.each(['login','logout','identify','prepareData'],function(t){var e=sa[t];sa[t]=function(){sa.hasInit?e.apply(sa,arguments):sa._queue.push({event:t,arg:arguments})}});export default sa;